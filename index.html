<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>MLB Hall of Fame Predictor</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
<body>

  <!-- Hamburger icon -->
  <div class="hamburger" onclick="toggleSidebar()">&#9776;</div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <a href="index.html">predictor</a>
    <a href="shortstops.html">shortstops</a>
    <a href="catchers.html">catchers</a>
    <a href="first_basemen.html">first basemen</a>
    <a href="#">second basemen</a>
    <a href="#">third basemen</a>
    <a href="#">outfielders</a>
    <a href="#">designated hitters</a>
  </div>
  <div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

  <!-- Top Ribbon -->
  <div class="top-ribbon">
    <div class="top-ribbon-content">
      <div class="left-group">
        <div class="hamburger" onclick="toggleSidebar()">&#9776;</div>
        <div class="project-title">MLB Hall of Fame Predictor</div>
      </div>
      <div class="author-links">
        <span class="author-name">by Christopher Moussa</span>
        |
        <a href="https://github.com/cmoussa1" target="_blank">github</a>
        |
        <a href="https://www.instagram.com/christopher.moussa/" target="_blank">instagram</a>
        |
        <a href="mailto:christopher.moussa97@gmail.com">email</a>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <div class="main-content" id="mainContent">
    <div class="container">
      <p>enter a player's information to calculate their HoF grade:</p>

      <input type="text" id="playerName" placeholder="player name">
      <input type="text" id="position" placeholder="position ('C', '1B', '2B', '3B', 'SS', 'OF', 'DH')">
      <input type="number" step="0.1" id="oWAR" placeholder="oWAR">
      <input type="number" step="0.1" id="dWAR" placeholder="dWAR">
      <input type="number" step="0.001" id="wOBA" placeholder="wOBA">
      <input type="number" step="1" id="wRCPlus" placeholder="wRC+">

      <button onclick="predictHOF()">Check Probability</button>

      <div id="result"></div>
    </div>
  </div>

  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');

      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
    }

    const hofDataByPosition = { 'SS': [], 'C': [], '1B': [], '2B': [], '3B': [], 'OF': [], 'DH': [] };

    async function loadCSVData(positionKey, fileName) {
      try {
        const response = await fetch(fileName);
        const text = await response.text();
        const lines = text.trim().split('\n').slice(1); // skip header
        hofDataByPosition[positionKey] = lines.map(line => {
          const columns = line.split(',');
          const name = columns[0];
          const hofGrade = parseFloat(columns[15]); // 16th column is index 15
          return { name, hofGrade };
        });
        console.log(`Loaded ${positionKey} HoF data:`, hofDataByPosition[positionKey]);
      } catch (error) {
        console.error(`Failed to load ${fileName}:`, error);
      }
    }

    function predictHOF() {
      const name = document.getElementById('playerName').value.trim();
      const position = document.getElementById('position').value.trim().toUpperCase();
      const oWAR = parseFloat(document.getElementById('oWAR').value);
      const dWAR = parseFloat(document.getElementById('dWAR').value);
      const wOBA = parseFloat(document.getElementById('wOBA').value);
      const wRCPlus = parseFloat(document.getElementById('wRCPlus').value);
      const resultEl = document.getElementById('result');

      if (!name || !position || isNaN(oWAR) || isNaN(dWAR) || isNaN(wOBA) || isNaN(wRCPlus)) {
        resultEl.innerText = 'Please enter all fields correctly, including position.';
        return;
      }

      if (!hofDataByPosition[position] || hofDataByPosition[position].length === 0) {
        resultEl.innerText = `No data available for position: ${position}`;
        return;
      }

      const hofGrade = (oWAR * 0.4 + dWAR * 0.3 + wOBA * 0.15 + wRCPlus * 0.15);
      const group = hofDataByPosition[position];
      const sortedGrades = group.map(player => player.hofGrade).sort((a, b) => a - b);
      const rank = sortedGrades.filter(g => g <= hofGrade).length;
      const percentile = ((rank / sortedGrades.length) * 100).toFixed(2);
      const averageGrade = sortedGrades.reduce((sum, val) => sum + val, 0) / sortedGrades.length;
      const gradeDiff = hofGrade - averageGrade;

      // determine probability based on percentile and grade difference
      let probability = 0;
      if (percentile > 45) {
        if (gradeDiff >= -2) probability = 80;
        else if (gradeDiff < -2 && gradeDiff >= -3) probability = 80;
        else if (gradeDiff < -3 && gradeDiff >= -5) probability = 65;
        else if (gradeDiff < -5 && gradeDiff >= -7) probability = 50;
        else if (gradeDiff < -7 && gradeDiff >= -9) probability = 35;
        else if (gradeDiff < -9) probability = 20;
      } else {
        if (gradeDiff >= -2) probability = 65;
        else if (gradeDiff < -2 && gradeDiff >= -3) probability = 65;
        else if (gradeDiff < -3 && gradeDiff >= -5) probability = 50;
        else if (gradeDiff < -5 && gradeDiff >= -7) probability = 35;
        else if (gradeDiff < -7 && gradeDiff >= -9) probability = 20;
        else if (gradeDiff < -9) probability = 5;
      }
      resultEl.innerHTML = "";

      // Lines to display
      const lines = [
        `estimated probability of election: ${probability}%.`,
        `${name} has a HoF Grade of ${hofGrade.toFixed(2)}.`,
        `percentile among elected HoF ${position}s: ${percentile}%.`,
        `difference from average HoF grade among elected HoF ${position}s: ${gradeDiff.toFixed(2)}.`,
      ];

      // Function to display lines one by one
      lines.forEach((line, index) => {
        setTimeout(() => {
          const p = document.createElement("p");
          p.textContent = line;
          p.style.opacity = 0;
          resultEl.appendChild(p);

          // Fade in animation
          setTimeout(() => {
            p.style.transition = "opacity 0.6s ease-in";
            p.style.opacity = 1;
          }, 50);
        }, index * 1000); // Delay each line by 1 second
      });
    }

    window.onload = () => {
      loadCSVData('SS', 'ss_data.csv');
      loadCSVData('C', 'c_data.csv');
      loadCSVData('1B', '1b_data.csv');
      loadCSVData('2B', '2b_data.csv');
      loadCSVData('3B', '3b_data.csv');
      loadCSVData('OF', 'of_data.csv');
      loadCSVData('DH', 'dh_data.csv');
    };

    window.addEventListener('scroll', handleVisibility);
    window.addEventListener('load', handleVisibility); // Also check on page load

    function handleVisibility() {
      const sections = document.querySelectorAll('.description-section');
      const triggerPoint = window.innerHeight * 0.9;

      sections.forEach(section => {
        const sectionTop = section.getBoundingClientRect().top;

        // Check if section is in view OR the page is short enough to show everything
        if (sectionTop < triggerPoint || document.body.scrollHeight <= window.innerHeight) {
          section.classList.add('visible');
        }
      });
    }
  </script>

  <div class="description-section" id="descriptionSection">
    <h2>about this project</h2>
    <p>
      Baseball lies not only in its timeless traditions but also continuously
      evolves and improves. The sport's Hall of Fame, a shrine of its
      most excellent players, managers, and icons in the sport, has remained a
      cherished, yet complex, tradition. My master's thesis sought to modernize
      the evaluation process by introducing a data-driven approach that
      centralizes four advanced statistical metrics: <b>Offensive Wins Above
        Replacement (oWAR), Defensive Wins Above Replacement (dWAR),
        Weighted On-Base Average (w/OBA), and Weighted Runs Created Plus
        (wRC+)</b>. This study challenges conventional notions of Hall of Fame
      candidacy that have for years relied on outdated and flawed statistics.
      Through statistical analysis, I look to uncover intriguing insights based
      on data aggregation of the current body of Hall of Fame position players,
      build a predictive model for current Hall of Fame candidates, and analyze
      past elections of rejected Hall of Fame candidates. This research aims to
      represent a progressive step toward more transparent, inclusive, and
      data-informed Hall of Fame selection processes for future candidates. By
      embracing modern statistical analysis and an open discourse about
      position-specific standards, this research aims to preserve the Hall of
      Fame's status as a shrine to excellence while at the same time introducing
      new ways to look at contemporary players and make decisive and objective
      comparisons to those considered the greatest to ever walk on the field. As
      the complexities of Hall of Fame induction are navigated, this research
      hopes to serve as a testament to the enduring spirit of baseballâ€”an
      endeavor where both numbers and narratives converge to honor those who
      have left an unforgettable mark on the sport.
    </p>
  </div>

  <div class="description-section" id="methodologySection">
    <h2>methodology</h2>
    <p>
      The approach for creating the quantifiable measurement for a given Hall of Famer
      and Hall of Fame candidate is straightforward. The grade <i>G</i> for a player is a sum
      of products, where each product is career statistic multiplied by a decimal weight
      that represents its importance in relation to the overall grade. The following
      equation describes how this project's Hall of Fame grade <i>G</i> is calculated:

      <div class="formula">
        $$ G = (oWAR \times 0.4) + (dWAR \times 0.3) + (\text{w/OBA} \times 0.15) + (wRC+ \times 0.15) $$
      </div>
    </p>
  </div>
</body>
</html>
